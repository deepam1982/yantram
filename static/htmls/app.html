<HTML>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<style>
		body{
			width:100%;
			height: 100%;
			padding:0;
			margin:0;
			text-align: center;
			background-color: rgb(215,211,182);
			font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
		}
		#appCont {
			min-height:100%;
			max-width:500px;
			margin:auto;
			background-color: rgb(255,255,255);
			text-align:left;
			padding:20px;
			position:relative;
		}
		hr {
			border:0;
			border-top: 1px solid #eeeeee;
			border-bottom: 1px solid #ffffff;
		}
		.roomTitleCont {
			padding:5px 20px;
			background:#69C1A8;
		}
		.switchCont {
			font-size: 14px;
		}
		input[type=range] {
		    -webkit-appearance: none;
		    background-color: black;
		    height:2px;
		}

		input[type="range"]::-webkit-slider-thumb {
		     -webkit-appearance: none;
		    /*background-color: rgb(71,167,78);
		    width: 15px;
		    height: 60px;
			border-radius:12px;    
		    */

    width: 10px;
    height: 60px;
    padding: 5px;
    border-radius: 20px;
    border: double 10px transparent;
    background: rgb(71,167,78);
    background-clip: padding-box;

		    position:relative;
		    top:10px;
		    cursor:pointer;
		}
	</style>
	<body>
		<div id='appCont' class='appArea'>
			<div style="font-weight:100;font-size:36px;color:#48C4B7; margin-bottom:18px;">
				<span style="color:gray;">Ino</span><span style="">ho</span>
			</div>
			<hr/>

		</div>	

	</body>
	<script type="text/javascript" src="/static/scripts/zepto/zepto.js"></script>
	<script type="text/javascript" src="/static/scripts/zepto/touch.js"></script>
<!--	
	<script type="text/javascript" src="http://static.mygola.com/static/11262/scripts/jquery-1.7.2.min.js"></script> 
-->
	<script type="text/javascript" src="/static/scripts/backbone/underscore.1.5.2.min.js"></script>
	<script type="text/javascript" src="/static/scripts/backbone/backbone.1.0.0.js"></script>
	<!-- backbone.1.0.0.min.js fails to work when we use this.options in view class-->
	<script type="text/javascript" src="/static/scripts/backbone/models/baseModel.js"></script>
	<script type="text/javascript" src="/static/scripts/backbone/models/roomModel.js"></script>
	<script type="text/template" id="roomTemplate">
		<div>
			<br/>
			<div class="roomTitleCont">
				<span style="text-align:left;font-size:24px;color:white;font-weight:400;"><%=name%></span>
				<img class='powerButton' src="static/images/power.png" style="width:25px;float:right;margin-top:2px;cursor:pointer;"/>
				<div style='clear:both;'></div>
			</div>
			<br/>
			<div class='switchCont'>
				
			</div>
			<div style='clear:both;'></div>	
		</div>	
	</script>
	<script type="text/template" id="basicSwitchTemplate">
		<div style='float:left;background-color:white;'>
			<div style='width:85px;float:left;text-align:center;'>
				<div class='toggelSwitch' style="width:85px;height:85px;cursor:pointer;background:url('<%=src%>');background-size: 85px Auto;" devId="<%=devId%>" switchId="<%=switchID%>"/><span><%=name%></span>
			</div>
			<div class='advancePannel' style='display:none; width:0; float:left;position:relative'>
				<div class='cross' style='position:absolute; right:5;top:4; cursor:pointer;font-size:20px;height:50px; width:30px; text-align:center;'><b>X</b></div>
			</div>
		</div>	
	</script>
	<script type="text/javascript" src="/static/scripts/backbone/views/baseView.js"></script>
	<script type="text/javascript" src="/static/scripts/backbone/views/switches/basic.js"></script>
	<script type="text/javascript" src="/static/scripts/backbone/views/switches/advance.js"></script>
	<script type="text/javascript" src="/static/scripts/backbone/views/room/view1.js"></script>
	<script type="text/javascript" src="/static/scripts/socket.io/socket.io.js"></script>
	<!--  <script src="/socket.io/socket.io.js"></script> -->
	<script>
	  var ioSocket = io.connect('/');
	  ioSocket.on('roomConfigUpdated', function (config) {
	  	rC.add(config, {merge: true});
	  });
	</script>
	<script>
		var backboneAjax = Backbone.ajax;
		Backbone.ajax = function (obj) {
			if(!obj.useSocket) return backboneAjax.call(arguments);
			// var data = (obj.data)?obj.data:{};
			// data.reqId = new Date().getTime()+''; 
			// ioSocket.once(data.reqId, obj.success);
			// ioSocket.emit(obj.url, data);
			ioSocket.emit(obj.url, obj.data, obj.success);
		}
		var RoomCollection = Backbone.Collection.extend({
			url: '/room/list',
			model:RoomModel
		});
		var rC = new RoomCollection();
		rC.on("add", function(roomModel){
			roomModel.on('change', function (model, data) {
				console.log("change called on "+model.get('name'));
				console.log(model);
			});
			var roomView = new RoomView1({model:roomModel});
			$('#appCont').append(roomView.$el);
			roomView.render();
		})
		rC.fetch({update:true, useSocket:true});
	</script>
	
<HTML>	
